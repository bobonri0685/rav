<!DOCTYPE html>
<html lang="en">
 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Avaliação de Estudantes</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <header>
        <h1>Dashboard de Avaliação</h1>
        <nav>
            <button id="add-student-btn">Cadastrar Novo Aluno</button>
            <button id="edit-student-btn">Editar Aluno</button>
            <button id="delete-student-btn">Excluir Aluno</button>
        </nav>
    </header>

    <main>
        <section id="student-selection">
            <h2>Escolha um Estudante para Avaliar</h2>
            <select id="student-list">
                <!-- Os estudantes serão carregados aqui -->
            </select>
        </section>

        <section id="student-details">
            <h2>Detalhes do Estudante</h2>
            <div id="student-info">
                <!-- Informações do estudante selecionado serão exibidas aqui -->
            </div>
        </section>
    </main>

    <!-- Modal para adicionar/editar estudante -->
    <div id="student-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2 id="modal-title">Adicionar/Editar Estudante</h2>
            <form id="student-form">
                <label for="student-name">Nome:</label>
                <input type="text" id="student-name" name="student-name" required>
                <label for="student-age">Idade:</label>
                <input type="number" id="student-age" name="student-age" required>
                <label for="student-grade">Série:</label>
                <input type="text" id="student-grade" name="student-grade" required>
                <button type="submit">Salvar</button>
            </form>
        </div>
    </div>

    <!-- Modal para confirmação de exclusão -->
    <div id="delete-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>Confirmar Exclusão</h2>
            <p>Tem certeza que deseja excluir este estudante?</p>
            <button id="confirm-delete-btn">Excluir</button>
            <button id="cancel-delete-btn">Cancelar</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const studentList = document.getElementById('student-list');
            const studentInfo = document.getElementById('student-info');
            const addStudentBtn = document.getElementById('add-student-btn');
            const editStudentBtn = document.getElementById('edit-student-btn');
            const deleteStudentBtn = document.getElementById('delete-student-btn');
            const studentModal = document.getElementById('student-modal');
            const deleteModal = document.getElementById('delete-modal');
            const closeBtns = document.querySelectorAll('.close-btn');
            const studentForm = document.getElementById('student-form');

            let students = [];

            // Função para abrir o modal
            function openModal(modal) {
                modal.style.display = 'block';
            }

            // Função para fechar o modal
            closeBtns.forEach(btn => {
                btn.onclick = function() {
                    this.parentElement.parentElement.style.display = 'none';
                };
            });

            // Event Listeners para os botões
            addStudentBtn.onclick = function() {
                openModal(studentModal);
                studentForm.dataset.mode = 'add';
                studentForm.reset();
            };

            editStudentBtn.onclick = function() {
                if (studentList.value) {
                    openModal(studentModal);
                    studentForm.dataset.mode = 'edit';
                    const selectedStudent = students.find(s => s.id == studentList.value);
                    if (selectedStudent) {
                        document.getElementById('student-name').value = selectedStudent.name;
                        document.getElementById('student-age').value = selectedStudent.age;
                        document.getElementById('student-grade').value = selectedStudent.grade;
                    }
                } else {
                    alert('Selecione um estudante para editar.');
                }
            };

            deleteStudentBtn.onclick = function() {
                if (studentList.value) {
                    openModal(deleteModal);
                } else {
                    alert('Selecione um estudante para excluir.');
                }
            };

            // Event Listener para o formulário de estudante
            studentForm.onsubmit = function(event) {
                event.preventDefault();
                const mode = studentForm.dataset.mode;
                const studentData = {
                    name: document.getElementById('student-name').value,
                    age: document.getElementById('student-age').value,
                    grade: document.getElementById('student-grade').value
                };

                if (mode === 'add') {
                    fetch('/api/students', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(studentData)
                    })
                    .then(response => response.json())
                    .then(data => {
                        loadStudents();
                        studentModal.style.display = 'none';
                    })
                    .catch(error => console.error('Erro:', error));
                } else if (mode === 'edit') {
                    fetch(`/api/students/${studentList.value}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(studentData)
                    })
                    .then(response => response.json())
                    .then(data => {
                        loadStudents();
                        studentModal.style.display = 'none';
                    })
                    .catch(error => console.error('Erro:', error));
                }
            };

            // Event Listener para confirmar exclusão
            document.getElementById('confirm-delete-btn').onclick = function() {
                fetch(`/api/students/${studentList.value}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    loadStudents();
                    deleteModal.style.display = 'none';
                })
                .catch(error => console.error('Erro:', error));
            };

            // Event Listener para cancelar exclusão
            document.getElementById('cancel-delete-btn').onclick = function() {
                deleteModal.style.display = 'none';
            };

            // Lógica para carregar a lista de estudantes
            function loadStudents() {
                fetch('/api/students')
                .then(response => response.json())
                .then(data => {
                    students = data;
                    studentList.innerHTML = '';
                    students.forEach(student => {
                        const option = document.createElement('option');
                        option.value = student.id;
                        option.textContent = student.name;
                        studentList.appendChild(option);
                    });
                })
                .catch(error => console.error('Erro:', error));
            }

            // Carregar estudantes ao carregar a página
            loadStudents();

            // Event Listener para exibir detalhes do estudante selecionado
            studentList.onchange = function() {
                const selectedStudent = students.find(s => s.id == this.value);
                if (selectedStudent) {
                    studentInfo.innerHTML = `
                        <p>Nome: ${selectedStudent.name}</p>
                        <p>Idade: ${selectedStudent.age}</p>
                        <p>Série: ${selectedStudent.grade}</p>
                    `;
                }
            };
        });
    </script>
</body>
</html>
s